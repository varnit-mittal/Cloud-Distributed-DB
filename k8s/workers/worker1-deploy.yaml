apiVersion: apps/v1
kind: Deployment
metadata:
  name: worker1
  namespace: kv-system
  labels:
    app: worker1
spec:
  replicas: 1
  selector:
    matchLabels:
      app: worker1
  template:
    metadata:
      labels:
        app: worker1
    spec:
      containers:
      - name: worker
        image: varn03/kv-worker:latest
        imagePullPolicy: IfNotPresent
        env:
          - name: NODE_ID
            value: "worker1"
          - name: CONTROLLER_ADDR
            value: "http://controller.kv-system.svc.cluster.local:8000"
          - name: REDIS_URL
            value: "redis://redis.kv-system.svc.cluster.local:6379/0"
          - name: MONGO_URL
            value: "mongodb://worker1-mongo:27017"
          - name: GRPC_PORT
            value: "50051"
          - name: HTTP_PORT
            value: "8001"
        ports:
          - containerPort: 8001
          - containerPort: 50051
